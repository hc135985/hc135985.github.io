<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>拖拽和点击上传简历 | 啊对对对</title>
    <meta name="description" content="描述个der">
    <link rel="stylesheet" href="/assets/style.019f39fc.css">
    <link rel="modulepreload" href="/assets/Home.077da6fb.js">
    <link rel="modulepreload" href="/assets/app.85083c31.js">
    <link rel="modulepreload" href="/assets/pages_upload.md.cd79d62c.lean.js">
    
    <meta name="twitter:title" content="拖拽和点击上传简历 | 啊对对对">
  <meta property="og:title" content="拖拽和点击上传简历 | 啊对对对">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="啊对对对, back to home" data-v-675d8756 data-v-4a583abe><!----> 啊对对对</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/pages/about" data-v-b8818f8c>关于 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/pages/about" data-v-b8818f8c>关于 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/pages/react-key">react-key</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/pages/upload">upload</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/pages/call_aplly_bind">call_aplly_bind</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="拖拽和点击上传简历" tabindex="-1">拖拽和点击上传简历 <a class="header-anchor" href="#拖拽和点击上传简历" aria-hidden="true">#</a></h1><h3 id="先看最终成果" tabindex="-1">先看最终成果 <a class="header-anchor" href="#先看最终成果" aria-hidden="true">#</a></h3><h4 id="upload" tabindex="-1">upload <a class="header-anchor" href="#upload" aria-hidden="true">#</a></h4><p><img src="https://s2.loli.net/2021/12/07/TLEYUARVu5Jfpnd.png" alt="ZRNLaGCamz.png">;</p><h4 id="uploading" tabindex="-1">uploading <a class="header-anchor" href="#uploading" aria-hidden="true">#</a></h4><p><img src="https://s2.loli.net/2021/12/07/xYjH9wRbgqfcrIv.png" alt="JvZvNuhcgc.png"></p><h4 id="uploaderror" tabindex="-1">uploadError <a class="header-anchor" href="#uploaderror" aria-hidden="true">#</a></h4><p><img src="https://s2.loli.net/2021/12/07/BlEe5kmK67QTx9d.png" alt="EkNfYV3NhU.png"></p><h4 id="uploadsuccess" tabindex="-1">uploadSuccess <a class="header-anchor" href="#uploadsuccess" aria-hidden="true">#</a></h4><p><img src="https://s2.loli.net/2021/12/07/XDmi8vodW6ZEFKx.png" alt="dTurZNXRSn.png"></p><h3 id="实现代码" tabindex="-1">实现代码 <a class="header-anchor" href="#实现代码" aria-hidden="true">#</a></h3><p>这个功能的主要的难点在拖拽这一块，没做过类似功能的肯定还是有点懵逼的。</p><p>要监听我们上传范围内的文件拖入、拖出、松开左键、滑动事件。</p><p>不bb，上代码</p><div class="language-js"><pre><code><span class="token comment">/**
 * 文件拖拽上传
 * @param {Number} count 单次上传个数  defaultValue =&gt; 1
 * @param {Function} btnEnter 划入回调 
 * @param {Function} btnLeave 划出/松开鼠标回调
 * @param {Function} onUpload 上传回调 参数 =&gt; FileList
 * @returns
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">FilesDragAndDrop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
    count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    btnEnter<span class="token punctuation">,</span>
    btnLeave<span class="token punctuation">,</span>
    onUpload<span class="token punctuation">,</span>
    children
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> drop <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleDragOver</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    btnLeave <span class="token operator">&amp;&amp;</span> <span class="token function">btnEnter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleDrop</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">]</span><span class="token punctuation">;</span>
    btnLeave <span class="token operator">&amp;&amp;</span> <span class="token function">btnLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&amp;&amp;</span> count <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">抱歉，每次最多只能上传</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 文件。</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">onUpload</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
    btnLeave <span class="token operator">&amp;&amp;</span> <span class="token function">btnLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleDragEnter</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    btnEnter <span class="token operator">&amp;&amp;</span> <span class="token function">btnEnter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleDragLeave</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    btnLeave <span class="token operator">&amp;&amp;</span> <span class="token function">btnLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dragover&#39;</span><span class="token punctuation">,</span> handleDragOver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;drop&#39;</span><span class="token punctuation">,</span> handleDrop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dragenter&#39;</span><span class="token punctuation">,</span> handleDragEnter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dragleave&#39;</span><span class="token punctuation">,</span> handleDragLeave<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dragover&#39;</span><span class="token punctuation">,</span> handleDragOver<span class="token punctuation">)</span><span class="token punctuation">;</span>
      drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;drop&#39;</span><span class="token punctuation">,</span> handleDrop<span class="token punctuation">)</span><span class="token punctuation">;</span>
      drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dragenter&#39;</span><span class="token punctuation">,</span> handleDragEnter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      drop<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dragleave&#39;</span><span class="token punctuation">,</span> handleDragLeave<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>drop<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token punctuation">{</span>classList<span class="token punctuation">.</span>FilesDragAndDrop<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 简单的调用</span>
<span class="token operator">&lt;</span>FilesDragAndDrop
  onUpload<span class="token operator">=</span><span class="token punctuation">{</span>onUpload<span class="token punctuation">}</span>
  btnLeave<span class="token operator">=</span><span class="token punctuation">{</span>btnLeave<span class="token punctuation">}</span>
  btnEnter<span class="token operator">=</span><span class="token punctuation">{</span>btnEnter<span class="token punctuation">}</span>
<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>uploadTitle<span class="token punctuation">}</span><span class="token operator">&gt;</span>将你的简历拖拽到此处自动解析<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div
    className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>uploadBtn<span class="token punctuation">}</span>
    onMouseLeave<span class="token operator">=</span><span class="token punctuation">{</span>btnLeave<span class="token punctuation">}</span>
    onMouseEnter<span class="token operator">=</span><span class="token punctuation">{</span>btnEnter<span class="token punctuation">}</span>
  <span class="token operator">&gt;</span>
    选择文件
    <span class="token operator">&lt;</span>input
      onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
      title<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">支持</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">ALLOW_EXT_TEXT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">格式文件，大小不超过</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>maxSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">M</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>
      size<span class="token operator">=</span><span class="token string">&quot;3&quot;</span>
      name<span class="token operator">=</span><span class="token string">&quot;newResume&quot;</span>
      type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>uploadText<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    支持word、pdf、ppt、txt、wps格式文件，文件大小控制在<span class="token number">10</span>M以内
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>FilesDragAndDrop<span class="token operator">&gt;</span>
</code></pre></div><p>然后就是一些上传失败成功的渲染处理了,分成一个一个小组件，更方便管理</p><div class="language-js"><pre><code><span class="token punctuation">{</span>status <span class="token operator">===</span> <span class="token string">&#39;upload&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Upload btnEnter<span class="token operator">=</span><span class="token punctuation">{</span>btnEnter<span class="token punctuation">}</span> btnLeave<span class="token operator">=</span><span class="token punctuation">{</span>btnLeave<span class="token punctuation">}</span> onUpload<span class="token operator">=</span><span class="token punctuation">{</span>onUpload<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span>status <span class="token operator">===</span> <span class="token string">&#39;uploading&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Uploading
    clearBtn<span class="token operator">=</span><span class="token punctuation">{</span>clearBtn<span class="token punctuation">}</span>
    clearChange<span class="token operator">=</span><span class="token punctuation">{</span>clearChange<span class="token punctuation">}</span>
    uploadChange<span class="token operator">=</span><span class="token punctuation">{</span>uploadChange<span class="token punctuation">}</span>
    err<span class="token operator">=</span><span class="token punctuation">{</span>err<span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span>status <span class="token operator">===</span> <span class="token string">&#39;uploadSuccess&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>UploadSuccess
    resume<span class="token operator">=</span><span class="token punctuation">{</span>resume<span class="token punctuation">}</span>
    setResumeData<span class="token operator">=</span><span class="token punctuation">{</span>setResumeData<span class="token punctuation">}</span>
    onUpload<span class="token operator">=</span><span class="token punctuation">{</span>onUpload<span class="token punctuation">}</span>
    delResume<span class="token operator">=</span><span class="token punctuation">{</span>delResume<span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre></div><p>代码逻辑比较简单，不多解释了，写成文档方便以后自己直接cv～</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/pages/react-key" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>react-key</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/pages/call_aplly_bind" data-v-38ede35f><span class="text" data-v-38ede35f>call_aplly_bind</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"834050ef\",\"pages_about.md\":\"f85345e1\",\"pages_call_aplly_bind.md\":\"c7b8aa11\",\"pages_react-key.md\":\"5ea5cf32\",\"pages_upload.md\":\"cd79d62c\"}")</script>
    <script type="module" async src="/assets/app.85083c31.js"></script>
    
  </body>
</html>